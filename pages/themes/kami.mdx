# Kami ä¸»é¢˜

import { ToGitHub } from '@components/ToGitHub';

<ToGitHub repo="mx-space/kami" />

import { Callout, Steps } from "nextra/components";


> ä¸‹ä¸€ä¸ªä»£æ›¿é¡¹ç›®å°†ä¼šæ˜¯ Shiroï¼Œå½“å®ƒå®Œæˆä¹‹æ—¶ï¼Œæˆ‘ä¾¿ä¸å†æŠ•å…¥ä»»ä½•ç²¾åŠ›åˆ° Kami ä¸­ã€‚è¿æ¥æœªæ¥æ€»éœ€è¦èˆå¼ƒä¸€äº›ä¸œè¥¿ï¼Œéå¸¸æ„Ÿè°¢å¤§å®¶ä¸‰å¹´æ¥ä½¿ç”¨ Kamiï¼Œä¸ç®¡ä½ æ˜¯è°ï¼Œéƒ½éœ€è¦å¯¹ä½ è¯´å£°è°¢è°¢ã€‚**â€”â€” Innei**



<Callout type="warning">
ç”±äº Kami ä¸»é¢˜å·²ä¸å†ç»´æŠ¤å¹¶ Achieved ï¼Œè¯¥éƒ¨åˆ†æ–‡æ¡£å°†ä¼šä¿æŒæœ€å°ç¨‹åº¦çš„æ›´æ–°ï¼›å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ Kami è¦æ±‚æœåŠ¡å™¨çš„ Linux å†…æ ¸ç‰ˆæœ¬ä¸å°äº 4.19ã€‚
</Callout>

## ç›®å‰å‘ç°çš„ä¸æ–°ç‰ˆ Core çš„å†²çª

ç”±äº Kami å·²ä¸å†ç»´æŠ¤ï¼Œå¦‚æœä½ æƒ³ç»§ç»­ä½¿ç”¨ï¼Œä½ éœ€è¦è‡ªè¡Œè§£å†³ Core ç‰ˆæœ¬æ›´æ–°å¸¦æ¥çš„ BREAKING CHANGE å¯¼è‡´çš„ kami åŠŸèƒ½ä¸¢å¤±é—®é¢˜ã€‚

- ç‚¹èµæ¥å£ä¸å…¼å®¹ï¼Œå·²è¿ç§»è‡³ `Activity Module` - [Source](https://github.com/mx-space/core/blob/master/apps/core/src/modules/activity/activity.controller.ts#L15-L26)
- é˜…è¯»è®¡æ•°ä¸å†è‡ªåŠ¨ increase, å·²æŠ½ç¦»è‡³ `Ack Module` - [Source](https://github.com/mx-space/core/blob/master/apps/core/src/modules/ack/ack.controller.ts#L31-L39)


<Steps>
### æ£€æŸ¥å†…æ ¸ç‰ˆæœ¬

```bash
uname -r
```
å¦‚æœä½ çš„å†…æ ¸ç‰ˆæœ¬å°äº 4.19ï¼Œè¯·å‡çº§å†…æ ¸ã€‚æˆ–è€…ä½¿ç”¨æœ€æ–°çš„ Ubuntu / Debian ã€‚


### å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/mx-space/kami.git --depth=1
cd kami && git fetch --tags && git checkout $(git rev-list --tags --max-count=1)
```

### å®‰è£…ä¾èµ–

```bash
git lfs fetch --all
git lfs pull
pnpm i
```

### é…ç½® ENV

1. å¤åˆ¶ .env.example ä¸º .env
2. ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå®ƒçœ‹èµ·æ¥åº”è¯¥æ˜¯è¿™ä¸ªæ ·å­çš„

```env
# API åœ°å€
NEXT_PUBLIC_API_URL=https://server.test.cn/api/v2
# GATEWAY åœ°å€
NEXT_PUBLIC_GATEWAY_URL=https://server.test.cn
#å‰ç«¯ä½¿ç”¨çš„é…ç½®é¡¹åå­—
NEXT_PUBLIC_SNIPPET_NAME=kami
# å¦‚æœä½¿ç”¨ CDN, ä¿®æ”¹äº§ç‰©å‰ç¼€ï¼›ä¸€èˆ¬ç•™ç©º
ASSETPREFIX=
```

### å¼€å§‹æ„å»º

```bash
pnpm build
```

### å¯åŠ¨å‰ç«¯

```bash
pnpm prod:pm2
```

</Steps>

## æ›´æ–°

åˆ†ä¸ºå¯¹ Kami è¿›è¡Œé­”æ”¹å’Œæœªé­”æ”¹ä¸¤ç§æƒ…å†µã€‚

### æœªé­”æ”¹

<Callout emoji="ğŸ’¡">
è¯¥æ–¹æ³•é€‚åˆäºå¯¹ Kami æºä»£ç æ²¡æœ‰åšæ”¹åŠ¨çš„ç”¨æˆ·ã€‚
</Callout>

ç›´æ¥åœ¨ `kami` æ–‡ä»¶å¤¹ä¸‹æ‰§è¡Œ `git pull origin master`ï¼š

```bash
cd ~/mx-space/kami
git pull origin master
```

å®‰è£…ä¾èµ–ã€æ„å»ºã€å¯åŠ¨å‰ç«¯ï¼š

```bash
pnpm i
pnpm build
pm2 start
```

<Callout type="warning" emoji="âš ï¸">
ä½ åº”è¯¥ç†è§£çš„æ˜¯ï¼Œå³ä¾¿æ˜¯ä½ æ²¡æœ‰å¯¹ Kami è¿›è¡Œä»»ä½•é­”æ”¹ï¼Œä»æœ‰å¯èƒ½å‡ºç°ä»£ç ä¸èƒ½è‡ªåŠ¨åˆå¹¶çš„é—®é¢˜ï¼Œå¯¹äºè¿™ç§æƒ…å†µï¼Œå»ºè®®å‚è€ƒä¸‹é¢çš„å·²é­”æ”¹éƒ¨åˆ†å®Œæˆå‡çº§ã€‚
</Callout>

### å·²é­”æ”¹

<Callout emoji="ğŸ’¡">
æ­¤æ–¹æ³•é€‚ç”¨äºå¯¹å‰ç«¯é­”æ”¹åçš„å‡çº§ï¼Œæˆ‘ä»¬è®¤ä¸ºä½ ä¿®æ”¹äº† 'kami/src' é‡Œé¢çš„æºä»£ç ï¼Œè¿™æ ·çš„è¯ï¼Œå®¹æ˜“å‡ºç°åˆå¹¶å†²çªï¼Œå»ºè®®æ‰‹åŠ¨æ›¿æ¢ã€‚
</Callout>

å°† `kami` æ–‡ä»¶å¤¹æ”¹ä¸ºä»»æ„åå­—ï¼Œä¾‹å¦‚ä¿®æ”¹ä¸º `kami.d`ï¼Œç„¶åæ‹‰å– kami å‰ç«¯ä»“åº“ï¼Œæ›´æ–°åˆ°ç¨³å®šç‰ˆæœ¬ï¼š

```bash
cd ~/mx-space
git clone https://github.com/mx-space/kami.git --depth=1
cd kami && git fetch --tags && git checkout $(git rev-list --tags --max-count=1)
```

ç„¶åå°†æ›´æ–°å‰ä¹‹å‰é…ç½®æ—¶ä¿®æ”¹è¿‡çš„æ–‡ä»¶ï¼Œå¦‚åœ¨ `kami.d` ä¸­çš„ `.env` å’Œ `public` æ–‡ä»¶å¤¹å¤åˆ¶åˆ° `kami`ï¼Œå°†ä½ çš„ä¿®æ”¹çš„éƒ¨åˆ†ä¾æ¬¡ä¿®æ”¹æ›¿æ¢å®Œæˆã€‚

å®‰è£…ä¾èµ–ã€æ„å»ºã€å¯åŠ¨å‰ç«¯ï¼š

```bash
pnpm i
pnpm build
pm2 start
```

<style global jsx>{`
 .nextra-content pre {
     max-height: 50vh;
  }
`}</style>
